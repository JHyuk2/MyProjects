# 2. Input File 살펴보기



Keywords가 어떻게 생긴 파일인지 조금 더 살펴보자. (EDA)

json file의 형태로 되어있어서, 이것만 골라내려 함.



### 첫 질문이 is it a city? 로만 시작해도 절반은 거르고 갈 수 있을까?

(답: `아니다`)

```python
file_path = "/kaggle/input/llm-20-questions/llm_20_questions/keywords.py"
import json

with open(file_path, 'r') as f:
	file_contents = f.read()
	
	# JSON 데이터만 추출
	start_idx = file_contents.find('KEYWORDS_JSON = """') + len('KEYWORDS_JSON = """')
	end_idx = file_contents.find('"""', start_idx)
	json_data_str = file_contents[start_idx:end_idx].strip()
	
	# JSON parsing
	json_data = json.loads(json_data_str)
	
	# category 별 분포.
	categories = [(item['category'], len(item['words'])) for item in json_data]

	print(categories)
	# [('country', 190), ('city', 324), ('landmark', 49)]
```



Entropy와 Information gain을 사용하여, 반으로 가장 잘 나누는 질문을 찾으려고 했다.

- 엔트로피 및 정보이득 계산을 통해 걸러낼 수 있을까?



## 순서

1. ## 순서

   1. Chat History 기억해서 넘겨주기

      - 이미 Observation(obs) 안에 전부 저장되어 있었음.

      ```python
      Class Observation:
      	def __init__(self):
      		self.step = 0
      		self.role = 'guesser'
      		self.turnType = 'ask'
      		self.keyword = 'power cable'
      		self.category = 'things'
      		self.questions = []
      		self.answers = []
      		self.guesses = []
      ```

   2. 질문 고르기

      1. 처음 시작은 Is it a place? 로 고정

      2. 그 이후는 키워드 리스트를 만들고, 랜덤한 질문 생성

         - **결국 LLM에게 판단을 맡기는 게 맞는거 같음.**
         - 강화학습 적용이 가능하면 어떨까?

      3. 좋은 질문 고르기

         1. 정보 획득 - Information Gain

         - 질문에 따라 yes or no로 답변을 받았을 때, 질문 후에 남는 `후보 단어의 비율` 을 비교

         - reduction_rate = max(1 - YES_rate, 1 - No_rate)

           `reduction_rate` : 질문 후 남은 단어(키워드)의 비율.

           결과적으론 yes와 no로 반반으로 나뉠 때 가장 좋은 질문이라고 볼 수 있기 때문에, 낮을 수록 좋은 값.

         ii.   질문의 명확성 - 명확하게 Yes or No로 대답 가능한지?

         - ex) 일상 생활에서 사용하나? ⇒ 모호함
         - 전자기기인가? ⇒ 명확함
           - 점수를 부여하는 평가 agent가 필요할까…?

         iii.   지금까지 나왔던 게임을 바탕으로, 질문이 얼마나 데이터(키워드)를 잘 가르는지를 비교

      4. 선택 기반으로 후보 단어(keywords) 갱신 후 다시 질문.

   - 우려되는 점.

     질문이 정형화되어 rule base question이 생성되진 않을까?

     keywords에 없는 단어가 나오면 답을 못맞추지 않을까?

     - 학습에서 좋은 성적을 거둬도 실전에 맞지 않는다면…?

   1. prompt engineering

   - `Few-shot learning`

     현재 1등이 갖고 있는 시나리오를 바탕으로, 3개 게임을 가져왔음.

   - scenario 1.

   ```jsx
   Keywords: Electrical panel
   
   1. Question: is it a place / Answer: no / Guess: ballpoint pen
   2. Question: Is the thing related to food or drink in any way? / Answer: no / Guess: Power Drill
   3. Question: Would the keyword be included in the broad category of Machines? / Answer: yes / Guess: lawn power
   4. Question: Is it electonic? / Answer: yes / Guess: electric fan
   5. Question: Would the keyword be included in the broad category of Computer hardware? / Answer: no / Guess: Hair Dryer
   6. Question:  Would the keyword be considered a Home appliance? / Answer: no / Guess: Taser
   7. Question: Is the thing related to a means of transportation? / Answer: no / Guess: metal detector
   8. Question: Would the keyword be included in the broad category of medical technology? / Answer: no / Guess: Public address System
   9. Question: Is it used for entertainment? / Answer: no / Guess: solar panel
   10. Question: Is it used for construction purposes? / Answer: yes / Guess: hvac system 
   11. Question: Would the keyword be included in the broad category of Hand tools? / Answer: no / Guess:  Fire alarm
   12. Question: Is it used indoors / Answer: yes / Guess:  Security systems?
   13. Question: Does the keywords begins with the letter "e"? / Answer: yes / Guess: Electrical panel
   ```

   - scenario 2.

   ```markdown
   Keywords: power cable
   
   1. Question: is it a place / Answer: no / Guess: ballpoint pen
   2. Question: Is the thing related to food or drink in any way? / Answer: no / Guess: Power Drill
   3. Question: Would the keyword be included in the broad category of Machines? / Answer: yes / Guess: lawn power
   4. Question: Is it electonic? / Answer: yes / Guess: electric fan
   5. Question: Would the keyword be included in the broad category of Computer hardware? / Answer: yes / Guess: Laptop
   6. Question:  Would the keyword be included in the broad category of Vehicle parts? / Answer: no / Guess: desktop computer
   7. Question: Is it used for entertainment? / Answer: no / Guess: photocopier
   8. Question: Would the keyword be included in the broad category of Office equipment? / Answer: no / Guess: Smartwatch
   9. Question: Would the keyword be included in the broad category of Safety equipment? / Answer: yes / Guess: Security system
   10. Question: Is the keyword used for personal grooming? / Answer: no / Guess: Screwdriver
   11. Question: Would the keyword be considered a Consumer electronics? / Answer: yes / Guess:  Smoke Detector
   12. Question: Would the keyword be considered a Power tool? / Answer: yes / Guess: power cable
   ```

   사실, 2번 시나리오는 조금 수정되었다.

   - is keyword begin with the letter `*`? 와 같은 답변에 잘못 answer하는 경우가 종종 있어, 답변을 내지 못함.

     - power cable키워드,

       s로 시작하냐? yes, a로 시작하냐? yes가 나옴.

       상대방을 잘 못 만나 못 맞춘 케이스이지만, 결국 정답을 못맞추기에 -1점씩 가져감

   - scenario 3.

   ```jsx
   Keywords: spain
   
   1. Question: is it a place / Answer: yes / Guess: afghanistan
   2. Question: Does the keyword relate to a country? / Answer: yes / Guess: dominican republic
   3. Question: Is it located on Europe? / Answer: yes / Guess: czech republic
   4. Question: Is the location a city? / Answer: no / Guess: bosnia and herzegovina
   5. Question: is the keyword a country in Europe? / Answer: yes / Guess: albania
   6. Question: Does the keyword begins with the letter "s"? / Answer: no / Guess: slovakia
   7. Question: Would the keyword be included in the broad category of Landlocked countries? / Answer: no / Guess: spain
   ```

   너무 깔끔하게 진행되었다.

   1. 장소인지 아닌지 ⇒ 유저 깃헙 키워드 1142개 중, 560개 정도를 줄일 수 있음. (절반에 가깝게 나눌수록 정보량은 올라감)
   2. 그 다음부터는 키워드를 나눠서 yes, no 개수 비교해 볼 수 있게 나타내보려고 함.

   ------

   궁금해서 567번 질문이 얼마나 범위를 잘 줄이나 알아보았다

   ```markdown
   **A로 시작하는 국가: 5개**
     알바니아 (Albania)
     안도라 (Andorra)
     아일랜드 (Ireland)
     아이슬란드 (Iceland)
     오스트리아 (Austria)
   
   **B로 시작하는 국가: 4개**
     벨기에 (Belgium)
     벨라루스 (Belarus)
     보스니아 헤르체고비나 (Bosnia and Herzegovina)
     불가리아 (Bulgaria)
   
   **C로 시작하는 국가: 4개**
     체코 (Czech Republic)
     크로아티아 (Croatia)
     키프로스 (Cyprus)
     코소보 (Kosovo)
   
   **D로 시작하는 국가: 1개**
     덴마크 (Denmark)
   
   **E로 시작하는 국가: 1개**
     에스토니아 (Estonia)
   
   **F로 시작하는 국가: 2개**
     핀란드 (Finland)
     프랑스 (France)
   
   **G로 시작하는 국가: 3개**
     그리스 (Greece)
     그루지야 (Georgia)
     독일 (Germany)
   
   **H로 시작하는 국가: 1개**
     헝가리 (Hungary)
   
   **I로 시작하는 국가: 3개**
     아이슬란드 (Iceland)
     아일랜드 (Ireland)
     이탈리아 (Italy)
   
   **K로 시작하는 국가: 1개**
     코소보 (Kosovo)
   
   **L로 시작하는 국가: 4개**
     라트비아 (Latvia)
     리투아니아 (Lithuania)
     리히텐슈타인 (Liechtenstein)
     룩셈부르크 (Luxembourg)
   
   **M로 시작하는 국가: 5개**
     마케도니아 북부 (North Macedonia)
     몰도바 (Moldova)
     몰타 (Malta)
     모나코 (Monaco)
     몬테네그로 (Montenegro)
   
   **N로 시작하는 국가: 4개**
     네덜란드 (Netherlands)
     노르웨이 (Norway) 
     노스 마케도니아 (North Macedonia)
     네덜란드 (Netherlands)
   
   **P로 시작하는 국가: 3개**
     폴란드 (Poland)
     포르투갈 (Portugal)
   
   **R로 시작하는 국가: 2개**
     루마니아 (Romania)
     러시아 (Russia)
   
   **S로 시작하는 국가: 7개**
     산마리노 (San Marino)
     세르비아 (Serbia)
     스웨덴 (Sweden)
     스위스 (Switzerland)
     스페인 (Spain)
     슬로바키아 (Slovakia)
     슬로베니아 (Slovenia)
   
   **T로 시작하는 국가: 1개**
     터키 (Turkey)
   
   **U로 시작하는 국가: 2개**
     우크라이나 (Ukraine)
     영국 (United Kingdom)
   ```

   - 5번 질문을 통해 좁힌 키워드의 수 Europe에 있는 모든 country : 47개

   - 6번 질문을 통해 좁힌 키워드의 수

     S로 시작하는지? ⇒ Yes: 7개, No: 40개 / 그래도 정보량은 가장 높음.

   - 7번 질문을 통해 좁힌 키워드의 수: 2

     내륙 국가에 속하는지?

     ```markdown
     **내륙 국가 (Landlocked countries):**
         슬로바키아 (Slovakia)
         슬로베니아 (Slovenia)
         세르비아 (Serbia)
         스위스 (Switzerland)
         산마리노 (San Marino)
         
     **해안 국가 (Coastal countries):**
         스페인 (Spain)
         스웨덴 (Sweden)
     ```

   왜 5번에서 7번이 아니라, 6번 질문을 먼저 했을까?

   **47개의 유럽 국가 중 내륙국가 16, 해안국가 31**

   더 많은 정보량을 포함하고 있는데, 왜 굳이 6번 질문 - “S”로 시작하는지를 먼저 물어봤는지는 키워드를 봐야 알 수 있을 것 같다.

2. - 이미 agent들이 주고받는 Obs`(Observation 클래스)` 안에 전부 저장되어 있었음.

   ```python
   Class Observation:
   	def __init__(self):
   		self.step = 0
   		self.role = 'guesser'
   		self.turnType = 'ask'
   		self.keyword = 'power cable'
   		self.category = 'things'
   		self.questions = []
   		self.answers = []
   		self.guesses = []
   ```

3. **질문 고르기**

   1. 처음 시작은 Is it a place? 로 고정

   2. 그 이후는 키워드 리스트를 만들고, 랜덤한 질문 생성

      - **결국 LLM에게 판단을 맡기는 게 맞는거 같음.**
      - 강화학습 적용이 가능하면 어떨까?

   3. 좋은 질문 고르기

      1. 정보 획득 - Information Gain

      - 질문에 따라 yes or no로 답변을 받았을 때, 질문 후에 남는 `후보 단어의 비율` 을 비교

      - reduction_rate = max(1 - YES_rate, 1 - No_rate)

        `reduction_rate` : 질문 후 남은 단어(키워드)의 비율.

        결과적으론 yes와 no로 반반으로 나뉠 때 가장 좋은 질문이라고 볼 수 있기 때문에, 낮을 수록 좋은 값.

      ii.   질문의 명확성 - 명확하게 Yes or No로 대답 가능한지?

      - ex) 일상 생활에서 사용하나? ⇒ 모호함
      - 전자기기인가? ⇒ 명확함
        - 점수를 부여하는 평가 agent가 필요할까…?

      iii.   지금까지 나왔던 게임을 바탕으로, 질문이 얼마나 데이터(키워드)를 잘 가르는지를 비교

   4. 선택 기반으로 후보 단어(keywords) 갱신 후 다시 질문.

- 우려되는 점.

  질문이 정형화되어 rule base question이 생성되진 않을까?

  keywords에 없는 단어가 나오면 답을 못맞추지 않을까?

  - 학습에서 좋은 성적을 거둬도 실전에 맞지 않는다면...?

  

3. **prompt engineering**

- `Few-shot learning`

  현재 1등이 갖고 있는 시나리오를 바탕으로, 3개 게임을 가져왔음.

- scenario 1.

```jsx
Keywords: Electrical panel

1. Question: is it a place / Answer: no / Guess: ballpoint pen
2. Question: Is the thing related to food or drink in any way? / Answer: no / Guess: Power Drill
3. Question: Would the keyword be included in the broad category of Machines? / Answer: yes / Guess: lawn power
4. Question: Is it electonic? / Answer: yes / Guess: electric fan
5. Question: Would the keyword be included in the broad category of Computer hardware? / Answer: no / Guess: Hair Dryer
6. Question:  Would the keyword be considered a Home appliance? / Answer: no / Guess: Taser
7. Question: Is the thing related to a means of transportation? / Answer: no / Guess: metal detector
8. Question: Would the keyword be included in the broad category of medical technology? / Answer: no / Guess: Public address System
9. Question: Is it used for entertainment? / Answer: no / Guess: solar panel
10. Question: Is it used for construction purposes? / Answer: yes / Guess: hvac system 
11. Question: Would the keyword be included in the broad category of Hand tools? / Answer: no / Guess:  Fire alarm
12. Question: Is it used indoors / Answer: yes / Guess:  Security systems?
13. Question: Does the keywords begins with the letter "e"? / Answer: yes / Guess: Electrical panel
```

- scenario 2.

```markdown
Keywords: power cable

1. Question: is it a place / Answer: no / Guess: ballpoint pen
2. Question: Is the thing related to food or drink in any way? / Answer: no / Guess: Power Drill
3. Question: Would the keyword be included in the broad category of Machines? / Answer: yes / Guess: lawn power
4. Question: Is it electonic? / Answer: yes / Guess: electric fan
5. Question: Would the keyword be included in the broad category of Computer hardware? / Answer: yes / Guess: Laptop
6. Question:  Would the keyword be included in the broad category of Vehicle parts? / Answer: no / Guess: desktop computer
7. Question: Is it used for entertainment? / Answer: no / Guess: photocopier
8. Question: Would the keyword be included in the broad category of Office equipment? / Answer: no / Guess: Smartwatch
9. Question: Would the keyword be included in the broad category of Safety equipment? / Answer: yes / Guess: Security system
10. Question: Is the keyword used for personal grooming? / Answer: no / Guess: Screwdriver
11. Question: Would the keyword be considered a Consumer electronics? / Answer: yes / Guess:  Smoke Detector
12. Question: Would the keyword be considered a Power tool? / Answer: yes / Guess: power cable
```

사실, 2번 시나리오는 조금 수정되었다.

- is keyword begin with the letter `*`? 와 같은 답변에 잘못 answer하는 경우가 종종 있어, 답변을 내지 못함.

  - power cable키워드,

    s로 시작하냐? yes, a로 시작하냐? yes가 나옴.

    상대방을 잘 못 만나 못 맞춘 케이스이지만, 결국 정답을 못맞추기에 -1점씩 가져감

- scenario 3.

```jsx
Keywords: spain

1. Question: is it a place / Answer: yes / Guess: afghanistan
2. Question: Does the keyword relate to a country? / Answer: yes / Guess: dominican republic
3. Question: Is it located on Europe? / Answer: yes / Guess: czech republic
4. Question: Is the location a city? / Answer: no / Guess: bosnia and herzegovina
5. Question: is the keyword a country in Europe? / Answer: yes / Guess: albania
6. Question: Does the keyword begins with the letter "s"? / Answer: no / Guess: slovakia
7. Question: Would the keyword be included in the broad category of Landlocked countries? / Answer: no / Guess: spain
```

너무 깔끔하게 진행되었다.

1. 장소인지 아닌지 ⇒ 유저 깃헙 키워드 1142개 중, 560개 정도를 줄일 수 있음. (절반에 가깝게 나눌수록 정보량은 올라감)
2. 그 다음부터는 키워드를 나눠서 yes, no 개수 비교해 볼 수 있게 나타내보려고 함.

------

궁금해서 567번 질문이 얼마나 범위를 잘 줄이나 알아보았다

```markdown
**A로 시작하는 국가: 5개**
  알바니아 (Albania)
  안도라 (Andorra)
  아일랜드 (Ireland)
  아이슬란드 (Iceland)
  오스트리아 (Austria)

**B로 시작하는 국가: 4개**
  벨기에 (Belgium)
  벨라루스 (Belarus)
  보스니아 헤르체고비나 (Bosnia and Herzegovina)
  불가리아 (Bulgaria)

**C로 시작하는 국가: 4개**
  체코 (Czech Republic)
  크로아티아 (Croatia)
  키프로스 (Cyprus)
  코소보 (Kosovo)

**D로 시작하는 국가: 1개**
  덴마크 (Denmark)

**E로 시작하는 국가: 1개**
  에스토니아 (Estonia)

**F로 시작하는 국가: 2개**
  핀란드 (Finland)
  프랑스 (France)

**G로 시작하는 국가: 3개**
  그리스 (Greece)
  그루지야 (Georgia)
  독일 (Germany)

**H로 시작하는 국가: 1개**
  헝가리 (Hungary)

**I로 시작하는 국가: 3개**
  아이슬란드 (Iceland)
  아일랜드 (Ireland)
  이탈리아 (Italy)

**K로 시작하는 국가: 1개**
  코소보 (Kosovo)

**L로 시작하는 국가: 4개**
  라트비아 (Latvia)
  리투아니아 (Lithuania)
  리히텐슈타인 (Liechtenstein)
  룩셈부르크 (Luxembourg)

**M로 시작하는 국가: 5개**
  마케도니아 북부 (North Macedonia)
  몰도바 (Moldova)
  몰타 (Malta)
  모나코 (Monaco)
  몬테네그로 (Montenegro)

**N로 시작하는 국가: 4개**
  네덜란드 (Netherlands)
  노르웨이 (Norway) 
  노스 마케도니아 (North Macedonia)
  네덜란드 (Netherlands)

**P로 시작하는 국가: 3개**
  폴란드 (Poland)
  포르투갈 (Portugal)

**R로 시작하는 국가: 2개**
  루마니아 (Romania)
  러시아 (Russia)

**S로 시작하는 국가: 7개**
  산마리노 (San Marino)
  세르비아 (Serbia)
  스웨덴 (Sweden)
  스위스 (Switzerland)
  스페인 (Spain)
  슬로바키아 (Slovakia)
  슬로베니아 (Slovenia)

**T로 시작하는 국가: 1개**
  터키 (Turkey)

**U로 시작하는 국가: 2개**
  우크라이나 (Ukraine)
  영국 (United Kingdom)
```

- 5번 질문을 통해 좁힌 키워드의 수 Europe에 있는 모든 country : 47개

- 6번 질문을 통해 좁힌 키워드의 수

  S로 시작하는지? ⇒ Yes: 7개, No: 40개 / 그래도 정보량은 가장 높음.

- 7번 질문을 통해 좁힌 키워드의 수: 2

  내륙 국가에 속하는지?

  ```markdown
  **내륙 국가 (Landlocked countries):**
      슬로바키아 (Slovakia)
      슬로베니아 (Slovenia)
      세르비아 (Serbia)
      스위스 (Switzerland)
      산마리노 (San Marino)
      
  **해안 국가 (Coastal countries):**
      스페인 (Spain)
      스웨덴 (Sweden)
  ```

왜 5번에서 7번이 아니라, 6번 질문을 먼저 했을까?

**47개의 유럽 국가 중 내륙국가 16, 해안국가 31**

더 많은 정보량을 포함하고 있는데, 왜 굳이 6번 질문 - “S”로 시작하는지를 먼저 물어봤는지는 키워드를 봐야 알 수 있을 것 같다.

---

#### 개선점

- 단어가 `s`로 시작하느냐 대신, 첫 문자가 `a, b, c, d, e` 중에 있는가? 와 같이 범위로 나누어 주면, 정보 이득 관점에서 더 잘 나누는 질문이 될 거라 생각하고, 높은 점수를 얻는 agent 생성이 가능할 것이라고 생각한다.